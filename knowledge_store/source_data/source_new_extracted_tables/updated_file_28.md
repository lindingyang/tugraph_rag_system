# RESTful API

> 此文档主要介绍 TuGrpah 的 Rest API 的调用详情。

## 1.简介
TuGraph 提供遵从 REST 规范的 HTTP API，以供开发者通过 HTTP 请求远程调用 TuGraph 提供的服务。

本文档描述 TuGraph 的 HTTP API 使用方式。

## 2.请求与响应格式
TuGraph HTTP Server 接收json格式的请求，经过鉴权后开始提取请求中的字段，根据定义好的接口逻辑处理请求，并返回json格式的响应。

### 2.1.标准响应格式
每一个响应都以标准响应格式返回，格式如下：

| body参数  | 参数说明         | 参数类型        | 是否必填       |
| ------- |--------------|-------------|------------|
| errorCode   | 业务级错误码       | int类型       | 是          |
| success   | 请求是否成功       | int类型       | 是          |
| errorMessage   | 业务级错误信息      | 字符串类型       | 是          |
| data   | 请求成功时返回的响应信息 | json字符串     | 是          |
表格内容描述：

本表格包含四列，分别为“body参数”、“参数说明”、“参数类型”和“是否必填”。

- 第一行：`errorCode`，表示业务级错误码，参数类型为整型（int），该参数是必填项。
- 第二行：`success`，表示请求是否成功，参数类型为整型（int），该参数也是必填项。
- 第三行：`errorMessage`，表示业务级错误信息，参数类型为字符串（string），同样是必填项。
- 第四行：`data`，表示请求成功时返回的响应信息，参数类型为JSON字符串，该参数也是必填项。

总体来看，该表格列出了与请求响应相关的必填参数及其说明，涵盖了错误码、请求成功状态、错误信息和成功时返回的数据格式。

### 2.2请求类型

#### 2.2.1. 用户登陆
用户在登陆请求中携带用户名和密码发送到服务端。登录成功会收到带有签名的令牌(Json Web Token)和判断是否为默认密码的布尔型变量，客户端储存该令牌，在后续的请求中将令牌加入请求头的Authorization域中。如果登录失败会收到“Authentication failed”错误。

- **URI**:     /login
- **METHOD**:  POST
- **REQUEST**:

| body参数 | 参数说明 | 参数类型  | 是否必填       |
| ------ |------|-------|------------|
| user   | 用户名  | 字符串类型   | 是          |
| password | 用户密码 | 字符串类型 | 是          |
表格内容描述: 此表格包含四列，分别为“body参数”、“参数说明”、“参数类型”和“是否必填”。

- 第一行数据为“user”，其参数说明为“用户名”，参数类型为“字符串类型”，且该参数为必填。
- 第二行数据为“password”，其参数说明为“用户密码”，参数类型为“字符串类型”，同样为必填。

总体来看，此表格列出了两个必填的参数（用户名和用户密码），并说明它们的类型均为字符串类型。

- **RESPONSE**:
  如果成功，返回的响应信息中success为00，data中包含令牌

| body参数          | 参数说明           | 参数类型   |
|------------------|--------------------|------------|
| jwt              | 令牌               | 字符串类型 |
| is_admin         | 是否是admin用户    | 布尔类型   |
表格内容描述: 本表格包含三列，分别为“body参数”、“参数说明”和“参数类型”。 

- 第一行数据为：
  - body参数：jwt
  - 参数说明：令牌
  - 参数类型：字符串类型

- 第二行数据为：
  - body参数：is_admin
  - 参数说明：是否是admin用户
  - 参数类型：布尔类型

总体来看，该表格列出了两个body参数及其说明和数据类型，分别为用于身份验证的字符串类型令牌和表示用户角色的布尔类型参数。
| default_password  | 默认密码           | 布尔类型   |
表格内容描述: 此表格包含三列，分别是"body参数"、"参数说明"和"参数类型"。

- 第一行数据列出"jwt"，其参数说明为"令牌"，参数类型为"字符串类型"。
- 第二行数据显示"is_admin"，其参数说明为"是否是admin用户"，参数类型为"布尔类型"。
- 第三行数据为"default_password"，其参数说明为"默认密码"，参数类型为"布尔类型"。

整体来看，该表格详细列出了三个与用户认证和权限相关的参数，以及它们的具体说明和数据类型。这些参数包括令牌、用户身份及默认密码设置，提供了用户管理功能的基本信息。

**Example request.**

```
    {"user" : "admin", "password" : "73@TuGraph"}
```

#### 2.2.2. 用户登出
用户登出，同时删除已经认证的token，用户后续发送请求时，需要重新登陆，并获取新的token。

- **URI**:     /logout
- **METHOD**:  POST
  - **REQUEST**:
    http request header中携带调用login接口时返回的token，具体填写的字符串是`Bearer ${jwt}`，`${jwt}`就是login接口返回的jwt，body中没有参数

| header参数           | 参数说明          | 参数类型   |
|------------------|---------------|------------|
| Authorization              | Bearer ${jwt} | 字符串类型 |
表格内容描述: 本表格共有三列，分别为“header参数”、“参数说明”和“参数类型”。在数据内容方面，第一行提供了一个header参数“Authorization”，其对应的参数说明为“Bearer ${jwt}”，参数类型为“字符串类型”。整体来看，该表格描述了一个用于认证的header参数的具体信息，包括其名称、用途以及数据类型。
表格内容描述: 

该表格包含三列，分别为“header参数”、“参数说明”和“参数类型”。 

- 在第一行中，header参数为“Authorization”，参数说明为“Bearer ${jwt}”，参数类型为“字符串类型”。

该表格的整体内容说明了一个HTTP请求的header参数，具体是用于身份验证的Authorization字段，其值格式为Bearer后接一个JWT（Json Web Token）字符串。该参数的数据类型为字符串。

- **RESPONSE**:
  如果成功，返回的响应信息中success为00，data中包含

| body参数          | 参数说明           | 参数类型   |
|------------------|--------------------|------------|
| is_admin         | 是否是admin用户    | 布尔类型   |
表格内容描述: 该表格包含三列，分别为“body参数”、“参数说明”和“参数类型”。表格中的数据行有一条，内容如下：参数“is_admin”表示用户是否为管理员，其参数类型为布尔类型。整体来看，表格提供了一个关于用户权限的参数设置，主要用于判断用户是否具有管理员权限。

#### 2.2.3. 身份刷新
已下发的token失效后，需要调用本接口重新认证。后端验证token合法性。token在初次登录后，1小时内有效，过期需要刷新

- **URI**:     /refresh
- **METHOD**:  POST
- **REQUEST**:
  http request header中携带调用login接口返回的token，具体填写的字符串是`Bearer ${jwt}`，`${jwt}`就是login接口返回的jwt，body中没有参数

| header参数           | 参数说明          | 参数类型   |
|------------------|---------------|------------|
| Authorization              | Bearer ${jwt} | 字符串类型 |

- **RESPONSE**:
  如果成功，返回的响应信息中success为00，data中包含令牌

| body参数          | 参数说明           | 参数类型   |
|------------------|--------------------|------------|
| jwt              | 令牌               | 字符串类型 |
| is_admin         | 是否是admin用户    | 布尔类型   |

#### 2.2.4. 调用cypher
用户对TuGraph的增删改查请求需要调用cypher接口，并通过标准的cypher查询语言发起

- **URI**:     /cypher
- **METHOD**:  POST
- **REQUEST**:

| header参数           | 参数说明          | 参数类型   |
|------------------|---------------|------------|
| Authorization              | Bearer ${jwt} | 字符串类型 |

| body参数  | 参数说明     | 参数类型  | 是否必填       |
| ------- |----------|-------|------------|
| graph   | 查询的子图名称  | 字符串类型   | 是          |
| script   | cypher语句 | 字符串类型 | 是          |
表格内容描述：

该表格包含两部分：header参数和body参数。

1. Header参数包含以下列：
   - 参数名称：Authorization
   - 参数说明：Bearer ${jwt}
   - 参数类型：字符串类型

2. Body参数则包含以下列：
   - 参数名称：graph
     - 参数说明：查询的子图名称
     - 参数类型：字符串类型
     - 是否必填：是
   - 参数名称：script
     - 参数说明：cypher语句
     - 参数类型：字符串类型
     - 是否必填：是

总体来看，该表格描述了一个API请求的必要参数。其中，header部分要求提供一个Bearer类型的身份验证令牌，而body部分则要求提供查询的子图名称和相应的cypher语句，二者均为必填项。

- **RESPONSE**:
  如果成功，返回的响应信息中success为00，data中包含查询结果

| body参数  | 参数说明 | 参数类型    | 是否必填       |
| ------- |------|---------|------------|
| result   | 查询结果 | json字符串 | 是          |
表格内容描述: 

该表格包含四列，分别为“body参数”、“参数说明”、“参数类型”和“是否必填”。

第一行的数据为：
- body参数为“result”；
- 参数说明为“查询结果”；
- 参数类型为“json字符串”； 
- 是否必填为“是”。

整体来看，表格仅包含一个参数“result”，它用于表示查询结果，类型为json字符串，并且该参数是必填项。

**Example request.**

```
    {"script" : "Match (n) return n", "graph" : "default"}
```